<!DOCTYPE html>
<html lang="fr" dir="ltr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Shopping List | Page </title>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0"
    />
    <link rel="stylesheet" href="./base.css">
    <link rel="stylesheet" href="./shopping.css" />
  </head>
  <body>
    <header class="shopping-header">
      <p>Liste de Courses</p>
      <span id="add-button" class="material-symbols-outlined"> add </span>
    </header>
    <main class="main shopping-main">
      <ul id="shopping-list"></ul>
      <p id="no-item"></p>
      <section id="new-item-input-container"></section>
    </main>
    <script>


   

      // tu stockes l'√©l√©ment HTML qui repr√©sente le bouton add-button dans une variable appel√©e addButton
      const addButton = document.getElementById("add-button");
      const shoppingList = document.getElementById("shopping-list");
      const newItemInputContainer = document.getElementById(
        "new-item-input-container"
      );

      const noItem = document.getElementById("no-item");

      function createNoItemMessage() {
        const children =
          Array.from(shoppingList.children).length == 0
            ? (noItem.innerText = "Aucun √©l√©ment pour le moment")
            : (noItem.innerText = "");
        console.log(children);
      }

      createNoItemMessage();

      // tout √©l√©ment d'une page HTML est un objet autrement tu peux utiliser sur cette objet la notation par point
      // que l'on appelle la dot notation
      // je vais cr√©er une fonction qui me cr√©e une zone de texte dans l'ul

      function createShoppingListItemLi(val) {
        console.log("üü†");
        const li = document.createElement("li");
        const time = new Date().getTime();
        const stringTime = time.toString();
        li.id = stringTime;
        li.innerHTML = `
            <div class="li-item-container"> 
                <p id="task-${li.id}">${val}</p> 
                <button id="checkbox-button-${li.id}" class="checkbox-button">
                    <span class="material-symbols-outlined">
                        check_box_outline_blank
                    </span>
                </button>
                <button id="delete-button-${li.id}" class="delete-button"> 
                    <span class="material-symbols-outlined">
                        delete
                    </span>
                </button>
            </div>
            `;
        shoppingList.appendChild(li);
        createNoItemMessage();
        // la fonction setTimeout est une fonction asynchrone qui 
        // attend qu'un certain d√©lai se soit √©coul√© avant d'ex√©cuter la callback qu'elle contient en argument 
        setTimeout(() => {
          
          const deleteButton = document.getElementById(
            `delete-button-${li.id}`
          );
          deleteButton.addEventListener("click", () => {
            const children = Array.from(shoppingList.children);
            const child = children.find((child) => child.id == li.id);
            shoppingList.removeChild(child);
            createNoItemMessage();
          });

          const checkboxButton = document.getElementById(`checkbox-button-${li.id}`)

          // GESTION DU CLIC SUR LA CHECKBOX
          checkboxButton.addEventListener('click', function(){

            //
            const task = document.getElementById(`task-${li.id}`)

            if(checkboxButton.dataset.isClicked=="true"){
                //si on a d√©j√† cliqu√© sur le bouton
                checkboxButton.dataset.isClicked="false"
                checkboxButton.innerHTML = `
                    <span class="material-symbols-outlined">
                        check_box_outline_blank
                    </span>
                `
                task.style.textDecoration = 'unset'
            } else {
                // si je n'ai pas encore cliqu√© sur le bouton
                const selectedCheckboxSpan = `
                <span class="material-symbols-outlined">
                    select_check_box
                </span>`
                task.style.textDecoration = 'line-through'
                checkboxButton.dataset.isClicked="true"
                checkboxButton.innerHTML=selectedCheckboxSpan



            }


          
          })
          

         

        }, 0);
      }

      // une fonction qui r√©cup√®re la valeur entr√©e par l'utilisateur  et elle passe cette valeur √† la fonction qui va cr√©er l'√©l√©ment dans la liste
      function takeTheInputValue() {

        console.log("üîµ");
        const inputValue = document.getElementById(
          "new-shopping-item-input"
        ).value;
        if(inputValue == ""){
            return
        }
        createShoppingListItemLi(inputValue);
      }

      function clickHandler() {
        takeTheInputValue();
      }

      function verifyIfInputDivExists() {
        // je v√©rifie que l'√©l√©ment html qui repr√©sent l'input de cr√©ation d'un nouvel √©l√©ment existe sur la page HTML
        const isPresentInPage = document.getElementById(
          "new-shopping-item-input"
        );

        const result = (isPresentInPage == null ? false : true);

        return result;
      }

      function createInputDiv() {
        // on v√©rifie en premier lieu si le formulaire d'ajout d'un nouvel est d√©j√† pr√©sent sur la page
        if (verifyIfInputDivExists()) {
          return;
        }

        // on cr√©e un input
        // on cr√©er un article qui va contenir l'input + le bouton sauvegarder
        const article = document.createElement("article");
        article.classList.add("shopping-list-item-input-article");
        // on cr√©e un input et un bouton
        const input = document.createElement("input");
        const button = document.createElement("button");
        button.textContent = "Sauvegarder";
        button.id = "save-button";

        button.addEventListener("click", clickHandler);
        // on ajoute √† l'article l'input puis le bouton
        article.appendChild(input);
        article.appendChild(button);
        // on d√©finit les attributs et leurs valeurs pour l'input
        input.setAttribute("placeholder", "Nouvelle √©l√©ment ...");
        //input.placeholder = 'Nouvelle √©l√©ment'
        input.setAttribute("type", "text");
        //input.type = "text"
        input.id = "new-shopping-item-input";
        //ajoute √©l√©ment dans l'arbre html existant

        // ajoute √† la sectin existante l'article
        newItemInputContainer.appendChild(article);
      }

      // je vais d√©finir la fonction qui sera ex√©cut√©e au moment du clic sur le boutton add-button
      function listener() {
        createInputDiv();
      }

      addButton.addEventListener("click", listener);
    </script>
  </body>
</html>
